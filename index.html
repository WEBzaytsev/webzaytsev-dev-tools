<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dev Tools</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<style>
		:root {
			--primary-color: #0070f3;
			--error-color: #ff4444;
			--success-color: #00c853;
			--border-color: #eaeaea;
			--text-color: #333;
			--bg-color: #ffffff;
			--nav-bg: #f8f9fa;
			--header-height: 60px;
			--tab-active: #0070f3;
			--tab-inactive: #666;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
			background: var(--bg-color);
			color: var(--text-color);
			line-height: 1.6;
			min-height: 100vh;
		}

		/* Навигация */
		.nav {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			height: var(--header-height);
			background: var(--nav-bg);
			border-bottom: 1px solid var(--border-color);
			display: flex;
			align-items: center;
			padding: 0 2rem;
			z-index: 1000;
		}

		.nav-brand {
			font-size: 1.25rem;
			font-weight: 700;
			color: var(--text-color);
			text-decoration: none;
			margin-right: 2rem;
		}

		.nav-menu {
			display: flex;
			gap: 1.5rem;
			list-style: none;
		}

		.nav-link {
			color: var(--text-color);
			text-decoration: none;
			font-weight: 500;
			padding: 0.5rem 0;
			border-bottom: 2px solid transparent;
			transition: all 0.2s;
		}

		.nav-link:hover,
		.nav-link.active {
			color: var(--primary-color);
			border-bottom-color: var(--primary-color);
		}

		/* Основной контент */
		.main {
			margin-top: var(--header-height);
			padding: 2rem;
			max-width: 1200px;
			margin-left: auto;
			margin-right: auto;
		}

		.container {
			background: var(--bg-color);
			border-radius: 12px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
			padding: 2rem;
		}

		/* Вкладки */
		.tabs {
			margin-bottom: 2rem;
			border-bottom: 1px solid var(--border-color);
		}

		.tab-buttons {
			display: flex;
			gap: 2rem;
		}

		.tab-button {
			padding: 1rem 0;
			border: none;
			background: none;
			cursor: pointer;
			font-size: 1rem;
			font-weight: 500;
			color: var(--tab-inactive);
			position: relative;
			min-width: 100px;
			text-align: center;
		}

		.tab-button:hover {
			color: var(--tab-active);
		}

		.tab-button.active {
			color: var(--tab-active);
		}

		.tab-button::after {
			content: '';
			position: absolute;
			bottom: -1px;
			left: 0;
			width: 100%;
			height: 2px;
			background: transparent;
			transition: all 0.2s ease;
		}

		.tab-button.active::after {
			background: var(--tab-active);
		}

		.tab-button:hover::after {
			background: var(--tab-active);
			opacity: 0.5;
		}

		.tab-content {
			display: none;
			padding-top: 2rem;
			animation: fadeIn 0.3s ease-in-out;
		}

		.tab-content.active {
			display: block;
		}

		@keyframes fadeIn {
			from { opacity: 0; }
			to { opacity: 1; }
		}

		/* Формы и кнопки */
		h2 {
			font-size: 1.75rem;
			font-weight: 700;
			margin-bottom: 1.5rem;
			color: #000;
		}

		.input-group {
			margin-bottom: 1.5rem;
		}

		.input-group.range-group {
			display: flex;
			align-items: center;
			gap: 1rem;
		}

		.input-group.range-group input[type="number"] {
			width: 80px;
			flex-shrink: 0;
		}

		input[type="range"] {
			flex-grow: 1;
			height: 4px;
			-webkit-appearance: none;
			background: var(--border-color);
			border-radius: 2px;
			outline: none;
		}

		input[type="range"]::-webkit-slider-thumb {
			-webkit-appearance: none;
			width: 16px;
			height: 16px;
			background: var(--primary-color);
			border-radius: 50%;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		input[type="range"]::-webkit-slider-thumb:hover {
			transform: scale(1.1);
		}

		input[type="range"]::-moz-range-thumb {
			width: 16px;
			height: 16px;
			background: var(--primary-color);
			border: none;
			border-radius: 50%;
			cursor: pointer;
			transition: all 0.2s ease;
		}

		input[type="range"]::-moz-range-thumb:hover {
			transform: scale(1.1);
		}

		label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: 500;
			font-size: 0.875rem;
		}

		input[type="number"] {
			width: 100%;
			padding: 0.75rem;
			border: 1px solid var(--border-color);
			border-radius: 8px;
			font-size: 1rem;
			transition: border-color 0.2s;
			outline: none;
		}

		input[type="number"]:focus {
			border-color: var(--primary-color);
		}

		.checkbox-group {
			margin: 1.5rem 0;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		input[type="checkbox"] {
			width: 1.25rem;
			height: 1.25rem;
			border-radius: 4px;
			cursor: pointer;
		}

		button {
			width: 100%;
			padding: 0.75rem;
			border: none;
			border-radius: 8px;
			background: var(--primary-color);
			color: white;
			font-size: 1rem;
			font-weight: 500;
			cursor: pointer;
			transition: opacity 0.2s;
		}

		button:hover {
			opacity: 0.9;
		}

		#result {
			margin-top: 1.5rem;
			padding: 1rem;
			border-radius: 8px;
			background: #f7f7f7;
			font-size: 1rem;
			text-align: center;
		}

		#result.error {
			background: #fff5f5;
			color: var(--error-color);
		}

		#copyButton {
			margin-top: 1rem;
			background: #fff;
			color: var(--primary-color);
			border: 1px solid var(--primary-color);
		}

		#notification {
			margin-top: 1rem;
			text-align: center;
			color: var(--success-color);
			font-size: 0.875rem;
		}

		@media (max-width: 480px) {
			.container {
				padding: 1.5rem;
			}
			
			.nav {
				padding: 0 1rem;
			}
		}

		/* Стили для Docker конвертера */
		.code-input {
			width: 100%;
			padding: 1rem;
			font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
			font-size: 0.875rem;
			line-height: 1.5;
			border: 1px solid var(--border-color);
			border-radius: 8px;
			background: #f8f9fa;
			resize: vertical;
			min-height: 100px;
		}

		.code-input:focus {
			border-color: var(--primary-color);
			outline: none;
		}

		.output-container {
			margin-top: 2rem;
		}

		.output-container h3 {
			font-size: 1.25rem;
			font-weight: 600;
			margin-bottom: 1rem;
		}

		.code-output-wrapper {
			position: relative;
			margin-top: 1rem;
			display: flex;
			flex-direction: column;
			gap: 0.5rem;
		}

		.code-output {
			width: 100%;
			padding: 1rem;
			background: #f8f9fa;
			border-radius: 8px;
			font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
			font-size: 0.875rem;
			line-height: 1.5;
			white-space: pre-wrap;
			margin: 0;
			border: 1px solid var(--border-color);
			overflow-x: auto;
		}

		.copy-button {
			position: static;
			align-self: flex-end;
			padding: 0.5rem 1rem;
			background: white;
			border: 1px solid var(--border-color);
			border-radius: 4px;
			display: flex;
			align-items: center;
			gap: 0.5rem;
			font-size: 0.875rem;
			color: var(--text-color);
			cursor: pointer;
			transition: all 0.2s ease;
			min-width: 6rem;
			justify-content: center;
			margin-bottom: 0.5rem;
		}

		.copy-button:hover {
			background: #f8f9fa;
			border-color: var(--text-color);
		}

		.copy-icon {
			opacity: 0.7;
		}

		/* Обновленные стили для Docker конвертера */
		.alert {
			padding: 1rem;
			border-radius: 8px;
			margin-top: 1rem;
		}

		.alert h4 {
			margin: 0 0 0.5rem 0;
			font-size: 1rem;
			font-weight: 600;
		}

		.alert ul {
			margin: 0;
			padding-left: 1.5rem;
		}

		.alert.warning {
			background: #fff3e0;
			border: 1px solid #ffb74d;
		}

		.alert.info {
			background: #e3f2fd;
			border: 1px solid #64b5f6;
		}

		.alert.error {
			background: #ffebee;
			border: 1px solid #ef5350;
		}

		.secondary-button {
			background: white;
			color: var(--primary-color);
			border: 1px solid var(--primary-color);
			padding: 0.75rem 1.5rem;
			border-radius: 8px;
			cursor: pointer;
			font-weight: 500;
			transition: all 0.2s ease;
		}

		.secondary-button:hover {
			background: var(--primary-color);
			color: white;
		}

		.secondary-button:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}
	</style>
</head>

<body>
	<nav class="nav">
		<a href="#" class="nav-brand">Dev Tools</a>
		<ul class="nav-menu">
			<li><a href="#" class="nav-link active">Инструменты</a></li>
			<li><a href="#" class="nav-link">О проекте</a></li>
			<li><a href="#" class="nav-link">GitHub</a></li>
		</ul>
	</nav>

	<main class="main">
		<div class="container">
			<div class="tabs">
				<div class="tab-buttons">
					<button class="tab-button active" data-tab="ports">Порты</button>
					<button class="tab-button" data-tab="hello">Docker</button>
					<button class="tab-button" data-tab="tokens">Токены</button>
				</div>

				<div class="tab-content active" id="ports">
					<h2>Port Generator</h2>
					<div class="input-group">
						<label for="minPortInput">Минимальный порт</label>
						<input type="number" id="minPortInput" value="10024">
					</div>

					<div class="input-group">
						<label for="maxPortInput">Максимальный порт</label>
						<input type="number" id="maxPortInput" value="60000">
					</div>

					<div class="checkbox-group">
						<input type="checkbox" id="rangeCheckbox">
						<label for="rangeCheckbox">Генерировать диапазон</label>
					</div>

					<div class="input-group" id="rangeField" style="display: none;">
						<label for="rangeInput">Размер диапазона</label>
						<input type="number" id="rangeInput">
					</div>

					<button id="generateButton">Сгенерировать порт</button>
					<p id="result"></p>
					<button id="copyButton" style="display: none;">Копировать</button>
					<p id="notification"></p>
				</div>

				<div class="tab-content" id="hello">
					<h2>Docker Run в Docker Compose</h2>
					<div class="input-group">
						<label for="dockerRunInput">Введите команду Docker Run</label>
						<textarea id="dockerRunInput" class="code-input" placeholder="docker run -p 80:80 -v /var/run/docker.sock:/tmp/docker.sock:ro --restart always --log-opt max-size=1g nginx" rows="4"></textarea>
					</div>

					<button id="convertButton">Конвертировать</button>

					<div class="output-container" style="display: none;">
						<h3>Docker Compose</h3>
						<div class="code-output-wrapper">
							<pre id="composeOutput" class="code-output"></pre>
							<button id="copyComposeButton" class="copy-button">
								<svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16">
									<path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
								</svg>
								Копировать
							</button>
						</div>
						<div class="download-button-wrapper" style="margin-top: 1rem; text-align: center;">
							<button id="downloadButton" class="secondary-button" style="max-width: 300px; margin: 0 auto;">
								Скачать docker-compose.yml
							</button>
						</div>
					</div>

					<div id="notTranslatableAlert" class="alert warning" style="display: none; margin-top: 1rem;">
						<h4>Эти опции не могут быть переведены в docker-compose</h4>
						<ul id="notTranslatableList"></ul>
					</div>

					<div id="notImplementedAlert" class="alert info" style="display: none; margin-top: 1rem;">
						<h4>Эти опции еще не реализованы</h4>
						<ul id="notImplementedList"></ul>
					</div>

					<div id="errorAlert" class="alert error" style="display: none; margin-top: 1rem;">
						<h4>Произошли следующие ошибки</h4>
						<ul id="errorList"></ul>
					</div>
				</div>

				<div class="tab-content" id="tokens">
					<h2>Генератор токенов</h2>
					<div class="input-group range-group">
						<input type="number" id="tokenLength" value="32" min="1" max="128">
						<input type="range" id="tokenLengthRange" value="32" min="1" max="128">
					</div>

					<div class="checkbox-group">
						<input type="checkbox" id="useUppercase" checked>
						<label for="useUppercase">Прописные буквы (A-Z)</label>
					</div>

					<div class="checkbox-group">
						<input type="checkbox" id="useLowercase" checked>
						<label for="useLowercase">Строчные буквы (a-z)</label>
					</div>

					<div class="checkbox-group">
						<input type="checkbox" id="useNumbers" checked>
						<label for="useNumbers">Цифры (0-9)</label>
					</div>

					<div class="checkbox-group">
						<input type="checkbox" id="useSpecial">
						<label for="useSpecial">Специальные символы (!@#$%^&*)</label>
					</div>

					<div class="button-group" style="display: flex; gap: 1rem; margin: 1.5rem 0;">
						<button class="secondary-button" id="regenerateToken" style="flex: 1;">
							<svg style="width: 16px; height: 16px; margin-right: 0.5rem;" viewBox="0 0 24 24">
								<path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
							</svg>
							Сгенерировать новый
						</button>
					</div>

					<div class="code-output-wrapper" style="margin-top: 1rem;" id="tokenOutput">
						<pre class="code-output" id="tokenResult"></pre>
						<button class="copy-button" id="copyTokenButton">
							<svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16">
								<path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
							</svg>
							Копировать
						</button>
					</div>
				</div>
			</div>
		</div>
	</main>

	<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://unpkg.com/composerize-ts@2.0.0/dist/index.js"></script>
	<script>
		const DEFAULT_MIN_PORT = 10024;
		const DEFAULT_MAX_PORT = 60000;
		const usedPortsKey = 'usedPorts';

		// DOM Elements
		const minPortInput = document.getElementById('minPortInput');
		const maxPortInput = document.getElementById('maxPortInput');
		const rangeCheckbox = document.getElementById('rangeCheckbox');
		const rangeField = document.getElementById('rangeField');
		const rangeInput = document.getElementById('rangeInput');
		const resultElement = document.getElementById('result');
		const generateButton = document.getElementById('generateButton');
		const copyButton = document.getElementById('copyButton');
		const notificationElement = document.getElementById('notification');

		// Event Listeners
		document.addEventListener('DOMContentLoaded', () => {
			rangeCheckbox.addEventListener('change', () => {
				rangeField.style.display = rangeCheckbox.checked ? 'block' : 'none';
			});

			generateButton.addEventListener('click', generatePort);
			copyButton.addEventListener('click', copyToClipboard);

			copyButton.style.display = 'none';
			notificationElement.style.display = 'none';

			const tabButtons = document.querySelectorAll('.tab-button');
			const tabContents = document.querySelectorAll('.tab-content');

			tabButtons.forEach(button => {
				button.addEventListener('click', () => {
					// Удаляем активный класс у всех кнопок и контента
					tabButtons.forEach(btn => btn.classList.remove('active'));
					tabContents.forEach(content => content.classList.remove('active'));

					// Добавляем активный класс к выбранной вкладке
					button.classList.add('active');
					const tabId = button.getAttribute('data-tab');
					document.getElementById(tabId).classList.add('active');
				});
			});
		});

		// Port Management Functions
		function loadUsedPorts() {
			const usedPortsJson = localStorage.getItem(usedPortsKey);
			return usedPortsJson ? new Set(JSON.parse(usedPortsJson)) : new Set();
		}

		function saveUsedPorts(usedPorts) {
			localStorage.setItem(usedPortsKey, JSON.stringify([...usedPorts]));
		}

		function generateUniqueStartPort(usedPorts, increment, minPort, maxPort) {
			let attempts = 0;
			const maxAttempts = 1000; // Предотвращение бесконечного цикла

			while (attempts < maxAttempts) {
				const startPort = Math.floor(Math.random() * (maxPort - minPort - increment + 1)) + minPort;
				let isUnique = true;

				for (let i = 0; i <= increment; i++) {
					if (usedPorts.has(startPort + i)) {
						isUnique = false;
						break;
					}
				}

				if (isUnique) return startPort;
				attempts++;
			}

			throw new Error("Не удалось найти свободный порт после " + maxAttempts + " попыток");
		}

		function showResult(message, isError = false) {
			resultElement.textContent = message;
			resultElement.className = isError ? 'error' : '';
			copyButton.style.display = isError ? 'none' : 'inline-block';
		}

		function generatePort() {
			try {
				const minPort = parseInt(minPortInput.value, 10) || DEFAULT_MIN_PORT;
				const maxPort = parseInt(maxPortInput.value, 10) || DEFAULT_MAX_PORT;

				if (minPort < 1000 || maxPort > 65535 || minPort >= maxPort) {
					throw new Error("Недопустимый диапазон портов");
				}

				const usedPorts = loadUsedPorts();

				if (rangeCheckbox.checked) {
					const increment = parseInt(rangeInput.value, 10);
					
					if (isNaN(increment) || increment <= 0) {
						throw new Error("Размер диапазона должен быть положительным числом");
					}

					const startPort = generateUniqueStartPort(usedPorts, increment, minPort, maxPort);
					const endPort = startPort + increment;

					for (let port = startPort; port <= endPort; port++) {
						usedPorts.add(port);
					}

					saveUsedPorts(usedPorts);
					showResult(`Сгенерирован диапазон портов: ${startPort}-${endPort}`);
				} else {
					const newPort = generateUniqueStartPort(usedPorts, 0, minPort, maxPort);
					usedPorts.add(newPort);
					saveUsedPorts(usedPorts);
					showResult(`Сгенерирован порт: ${newPort}`);
				}
			} catch (error) {
				showResult(error.message, true);
			}
		}

		function copyToClipboard() {
			const resultText = resultElement.textContent;
			const match = resultText.match(/\d+(-\d+)?/);
			
			if (match) {
				navigator.clipboard.writeText(match[0])
					.then(() => {
						notificationElement.textContent = "Скопировано в буфер обмена";
						notificationElement.style.display = 'block';
						setTimeout(() => {
							notificationElement.style.display = 'none';
						}, 2000);
					})
					.catch(err => {
						console.error('Ошибка копирования:', err);
						notificationElement.textContent = "Ошибка при копировании";
						notificationElement.style.display = 'block';
					});
			}
		}

		// Docker конвертер
		const DockerCommandParser = {
			MessageType: {
				notImplemented: 'notImplemented',
				notTranslatable: 'notTranslatable',
				errorDuringConversion: 'errorDuringConversion'
			},

			parseCommand(command) {
				const tokens = this.tokenize(command);
				const options = this.parseOptions(tokens);
				return this.generateCompose(options);
			},

			tokenize(command) {
				return command
					.match(/(?:[^\s"']+|"[^"]*"|'[^']*')+/g)
					.map(token => token.replace(/^["']|["']$/g, ''));
			},

			parseOptions(tokens) {
				const options = {
					image: '',
					ports: [],
					volumes: [],
					environment: [],
					restart: '',
					name: '',
					network: '',
					workdir: '',
					user: '',
					command: [],
					entrypoint: [],
					labels: [],
					links: [],
					capAdd: [],
					capDrop: [],
					devices: [],
					dns: [],
					expose: [],
					extraHosts: [],
					logOpt: {},
					messages: []
				};

				for (let i = 0; i < tokens.length; i++) {
					const token = tokens[i];
					
					if (token === 'docker' || token === 'run') continue;

					switch (token) {
						case '-p':
						case '--publish':
							options.ports.push(tokens[++i]);
							break;
						case '-v':
						case '--volume':
							options.volumes.push(tokens[++i]);
							break;
						case '-e':
						case '--env':
							options.environment.push(tokens[++i]);
							break;
						case '--restart':
							options.restart = tokens[++i];
							break;
						case '--name':
							options.name = tokens[++i];
							break;
						case '--network':
							options.network = tokens[++i];
							break;
						case '-w':
						case '--workdir':
							options.workdir = tokens[++i];
							break;
						case '-u':
						case '--user':
							options.user = tokens[++i];
							break;
						case '--entrypoint':
							options.entrypoint = [tokens[++i]];
							break;
						case '--log-opt':
							const [key, value] = tokens[++i].split('=');
							options.logOpt[key] = value;
							break;
						case '--cap-add':
							options.capAdd.push(tokens[++i]);
							break;
						case '--cap-drop':
							options.capDrop.push(tokens[++i]);
							break;
						case '--device':
							options.devices.push(tokens[++i]);
							break;
						case '--dns':
							options.dns.push(tokens[++i]);
							break;
						case '--expose':
							options.expose.push(tokens[++i]);
							break;
						case '--add-host':
							options.extraHosts.push(tokens[++i]);
							break;
						case '--label':
						case '-l':
							options.labels.push(tokens[++i]);
							break;
						case '--link':
							options.links.push(tokens[++i]);
							break;
						default:
							if (!token.startsWith('-') && !options.image) {
								options.image = token;
							} else if (!token.startsWith('-')) {
								options.command.push(token);
							} else {
								options.messages.push({
									type: this.MessageType.notImplemented,
									value: `Опция ${token} не реализована`
								});
							}
					}
				}

				return options;
			},

			generateCompose(options) {
				let yaml = 'version: "3.8"\n\nservices:\n';
				const serviceName = options.name || 'app';
				yaml += `  ${serviceName}:\n`;

				// Обязательные поля
				yaml += `    image: ${options.image}\n`;

				// Опциональные поля
				if (options.ports.length) {
					yaml += '    ports:\n';
					options.ports.forEach(port => {
						yaml += `      - "${port}"\n`;
					});
				}

				if (options.volumes.length) {
					yaml += '    volumes:\n';
					options.volumes.forEach(volume => {
						yaml += `      - ${volume}\n`;
					});
				}

				if (options.environment.length) {
					yaml += '    environment:\n';
					options.environment.forEach(env => {
						yaml += `      - ${env}\n`;
					});
				}

				if (options.restart) {
					yaml += `    restart: ${options.restart}\n`;
				}

				if (options.network) {
					yaml += `    networks:\n      - ${options.network}\n`;
				}

				if (options.workdir) {
					yaml += `    working_dir: ${options.workdir}\n`;
				}

				if (options.user) {
					yaml += `    user: ${options.user}\n`;
				}

				if (options.command.length) {
					yaml += `    command: ${options.command.join(' ')}\n`;
				}

				if (options.entrypoint.length) {
					yaml += `    entrypoint: ${options.entrypoint[0]}\n`;
				}

				if (Object.keys(options.logOpt).length) {
					yaml += '    logging:\n      options:\n';
					for (const [key, value] of Object.entries(options.logOpt)) {
						yaml += `        ${key}: ${value}\n`;
					}
				}

				if (options.capAdd.length) {
					yaml += '    cap_add:\n';
					options.capAdd.forEach(cap => {
						yaml += `      - ${cap}\n`;
					});
				}

				if (options.capDrop.length) {
					yaml += '    cap_drop:\n';
					options.capDrop.forEach(cap => {
						yaml += `      - ${cap}\n`;
					});
				}

				if (options.devices.length) {
					yaml += '    devices:\n';
					options.devices.forEach(device => {
						yaml += `      - ${device}\n`;
					});
				}

				if (options.dns.length) {
					yaml += '    dns:\n';
					options.dns.forEach(dns => {
						yaml += `      - ${dns}\n`;
					});
				}

				if (options.expose.length) {
					yaml += '    expose:\n';
					options.expose.forEach(port => {
						yaml += `      - "${port}"\n`;
					});
				}

				if (options.extraHosts.length) {
					yaml += '    extra_hosts:\n';
					options.extraHosts.forEach(host => {
						yaml += `      - ${host}\n`;
					});
				}

				if (options.labels.length) {
					yaml += '    labels:\n';
					options.labels.forEach(label => {
						const [key, value] = label.split('=');
						yaml += `      - ${key}=${value}\n`;
					});
				}

				if (options.links.length) {
					yaml += '    links:\n';
					options.links.forEach(link => {
						yaml += `      - ${link}\n`;
					});
				}

				return {
					yaml,
					messages: options.messages
				};
			}
		};

		function parseDockerCommand(command) {
			try {
				return DockerCommandParser.parseCommand(command);
			} catch (error) {
				console.error('Error during conversion:', error);
				return {
					yaml: '',
					messages: [{
						type: DockerCommandParser.MessageType.errorDuringConversion,
						value: error.message || 'Неизвестная ошибка при конвертации'
					}]
				};
			}
		}

		function downloadYamlFile(content) {
			const blob = new Blob([content], { type: 'application/yaml' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'docker-compose.yml';
			document.body.appendChild(a);
			a.click();
			document.body.removeChild(a);
			URL.revokeObjectURL(url);
		}

		document.addEventListener('DOMContentLoaded', () => {
			const dockerRunInput = document.getElementById('dockerRunInput');
			const convertButton = document.getElementById('convertButton');
			const composeOutput = document.getElementById('composeOutput');
			const outputContainer = document.querySelector('.output-container');
			const copyComposeButton = document.getElementById('copyComposeButton');
			const downloadButton = document.getElementById('downloadButton');
			
			// Alerts
			const notTranslatableAlert = document.getElementById('notTranslatableAlert');
			const notImplementedAlert = document.getElementById('notImplementedAlert');
			const errorAlert = document.getElementById('errorAlert');
			const notTranslatableList = document.getElementById('notTranslatableList');
			const notImplementedList = document.getElementById('notImplementedList');
			const errorList = document.getElementById('errorList');

			convertButton.addEventListener('click', () => {
				const command = dockerRunInput.value.trim();
				if (!command) return;

				// Очищаем предыдущие сообщения
				notTranslatableAlert.style.display = 'none';
				notImplementedAlert.style.display = 'none';
				errorAlert.style.display = 'none';
				notTranslatableList.innerHTML = '';
				notImplementedList.innerHTML = '';
				errorList.innerHTML = '';

				const result = parseDockerCommand(command);
				
				if (result.yaml) {
					composeOutput.textContent = result.yaml;
					outputContainer.style.display = 'block';
					downloadButton.disabled = false;
				} else {
					composeOutput.textContent = 'Ошибка при конвертации команды';
					outputContainer.style.display = 'block';
					downloadButton.disabled = true;
				}

				// Обработка сообщений
				const notTranslatable = result.messages.filter(msg => msg.type === 'notTranslatable');
				const notImplemented = result.messages.filter(msg => msg.type === 'notImplemented');
				const errors = result.messages.filter(msg => msg.type === 'errorDuringConversion');

				if (notTranslatable.length > 0) {
					notTranslatableAlert.style.display = 'block';
					notTranslatable.forEach(msg => {
						const li = document.createElement('li');
						li.textContent = msg.value;
						notTranslatableList.appendChild(li);
					});
				}

				if (notImplemented.length > 0) {
					notImplementedAlert.style.display = 'block';
					notImplemented.forEach(msg => {
						const li = document.createElement('li');
						li.textContent = msg.value;
						notImplementedList.appendChild(li);
					});
				}

				if (errors.length > 0) {
					errorAlert.style.display = 'block';
					errors.forEach(msg => {
						const li = document.createElement('li');
						li.textContent = msg.value;
						errorList.appendChild(li);
					});
				}
			});

			copyComposeButton.addEventListener('click', () => {
				navigator.clipboard.writeText(composeOutput.textContent)
					.then(() => {
						copyComposeButton.textContent = 'Скопировано!';
						setTimeout(() => {
							copyComposeButton.innerHTML = `
								<svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16">
									<path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
								</svg>
								Копировать
							`;
						}, 2000);
					});
			});

			downloadButton.addEventListener('click', () => {
				if (composeOutput.textContent) {
					downloadYamlFile(composeOutput.textContent);
				}
			});
		});

		// Генератор токенов
		document.addEventListener('DOMContentLoaded', () => {
			const tokenLength = document.getElementById('tokenLength');
			const tokenLengthRange = document.getElementById('tokenLengthRange');
			const useUppercase = document.getElementById('useUppercase');
			const useLowercase = document.getElementById('useLowercase');
			const useNumbers = document.getElementById('useNumbers');
			const useSpecial = document.getElementById('useSpecial');
			const regenerateToken = document.getElementById('regenerateToken');
			const tokenOutput = document.getElementById('tokenOutput');
			const tokenResult = document.getElementById('tokenResult');
			const copyTokenButton = document.getElementById('copyTokenButton');

			// Синхронизация значений ползунка и числового поля
			tokenLength.addEventListener('input', generateToken);
			tokenLengthRange.addEventListener('input', () => {
				tokenLength.value = tokenLengthRange.value;
				generateToken();
			});

			// Генерация при изменении чекбоксов
			useUppercase.addEventListener('change', generateToken);
			useLowercase.addEventListener('change', generateToken);
			useNumbers.addEventListener('change', generateToken);
			useSpecial.addEventListener('change', generateToken);

			// Кнопка генерации нового токена
			regenerateToken.addEventListener('click', generateToken);

			function generateToken() {
				try {
					const length = parseInt(tokenLength.value);
					if (length < 1 || length > 128) {
						throw new Error('Длина токена должна быть от 1 до 128 символов');
					}

					const options = {
						uppercase: useUppercase.checked,
						lowercase: useLowercase.checked,
						numbers: useNumbers.checked,
						special: useSpecial.checked
					};

					const charset = {
						uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
						lowercase: 'abcdefghijklmnopqrstuvwxyz',
						numbers: '0123456789',
						special: '!@#$%^&*'
					};

					let availableChars = '';
					if (options.uppercase) availableChars += charset.uppercase;
					if (options.lowercase) availableChars += charset.lowercase;
					if (options.numbers) availableChars += charset.numbers;
					if (options.special) availableChars += charset.special;

					if (!availableChars) {
						throw new Error('Выберите хотя бы один набор символов');
					}

					let result = '';
					const randomValues = new Uint32Array(length);
					crypto.getRandomValues(randomValues);
					
					for (let i = 0; i < length; i++) {
						result += availableChars[randomValues[i] % availableChars.length];
					}

					tokenResult.textContent = result;
				} catch (error) {
					tokenResult.textContent = error.message;
				}
			}

			copyTokenButton.addEventListener('click', () => {
				navigator.clipboard.writeText(tokenResult.textContent)
					.then(() => {
						copyTokenButton.textContent = 'Скопировано!';
						setTimeout(() => {
							copyTokenButton.innerHTML = `
								<svg class="copy-icon" viewBox="0 0 24 24" width="16" height="16">
									<path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
								</svg>
								Копировать
							`;
						}, 2000);
					});
			});

			// Генерируем токен при загрузке страницы
			generateToken();
		});
	</script>
</body>

</html>